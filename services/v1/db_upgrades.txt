CREATE TABLE note_flags (player_id int(10) unsigned NOT NULL DEFAULT 0, note_id int(10) unsigned NOT NULL DEFAULT 0, created timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (player_id, note_id)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

CREATE TABLE note_shares (share_id  int(10) unsigned NOT NULL AUTO_INCREMENT, player_id  int(10) unsigned NOT NULL DEFAULT 0, note_id int(10) unsigned NOT NULL DEFAULT 0, share_type enum('FACEBOOK', 'TWITTER', 'PINTEREST', 'EMAIL') COLLATE utf8_unicode_ci DEFAULT NULL, created timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (share_id)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

ALTER TABLE players ADD curator tinyint(1) unsigned NOT NULL DEFAULT 0;
ALTER TABLE players ADD facebook_id int(11) unsigned NOT NULL DEFAULT 0;
ALTER TABLE game_tags ADD media_id int(11) unsigned NOT NULL DEFAULT 0;

ALTER TABLE quests DROP COLUMN exit_to_tab;
ALTER TABLE quests ADD COLUMN go_function ENUM('NONE','NEARBY','GPS','QUESTS','INVENTORY','PLAYER','QR','NOTE','PICKGAME','JAVASCRIPT') NOT NULL DEFAULT 'NONE';

ALTER TABLE games ADD COLUMN note_title_behavior ENUM('NONE','FORCE_OVERWRITE') NOT NULL DEFAULT 'FORCE_OVERWRITE';

ALTER TABLE game_object_tags ADD COLUMN media_id int(10) unsigned NOT NULL DEFAULT 0;

ALTER TABLE game_object_tags ADD COLUMN use_for_sort tinyint(1) unsigned NOT NULL DEFAULT 0;

ALTER TABLE player_log CHANGE event_type event_type enum('LOGIN','MOVE','PICKUP_ITEM','DROP_ITEM','DROP_NOTE','DESTROY_ITEM','VIEW_ITEM','VIEW_NODE','VIEW_NPC','VIEW_WEBPAGE','VIEW_AUGBUBBLE','VIEW_MAP','VIEW_QUESTS','VIEW_INVENTORY','ENTER_QRCODE','UPLOAD_MEDIA_ITEM','UPLOAD_MEDIA_ITEM_IMAGE','UPLOAD_MEDIA_ITEM_AUDIO','UPLOAD_MEDIA_ITEM_VIDEO','RECEIVE_WEBHOOK','SEND_WEBHOOK','COMPLETE_QUEST','CREATE_NOTE','GET_NOTE','GIVE_NOTE_LIKE','GET_NOTE_LIKE','GIVE_NOTE_COMMENT','GET_NOTE_COMMENT');

ALTER TABLE games ADD COLUMN latitude   DOUBLE NOT NULL DEFAULT 0.0;
ALTER TABLE games ADD COLUMN longitude  DOUBLE NOT NULL DEFAULT 0.0;
ALTER TABLE games ADD COLUMN zoom_level DOUBLE NOT NULL DEFAULT 0.0;

ALTER TABLE quests ADD COLUMN description_notification TINYTEXT NOT NULL DEFAULT "";
ALTER TABLE quests ADD COLUMN text_when_complete_notification TINYTEXT NOT NULL DEFAULT "";
ALTER TABLE quests ADD COLUMN active_notification_media_id INT(10) UNSIGNED NOT NULL DEFAULT 0;
ALTER TABLE quests ADD COLUMN complete_notification_media_id INT(10) UNSIGNED NOT NULL DEFAULT 0;

ALTER TABLE quests ADD COLUMN complete_go_function ENUM('NONE','NEARBY','GPS','INVENTORY','PLAYER','QR','NOTE','PICKGAME','JAVASCRIPT') NOT NULL DEFAULT "NONE";

ALTER TABLE quests ADD COLUMN complete_full_screen_notify TINYINT(1) NOT NULL DEFAULT 1;
ALTER TABLE quests ADD COLUMN active_notif_show_dismiss TINYINT(1) NOT NULL DEFAULT 1;
ALTER TABLE quests ADD COLUMN complete_notif_show_dismiss TINYINT(1) NOT NULL DEFAULT 1;
ALTER TABLE quests ADD COLUMN notif_go_function ENUM('NONE','NEARBY','GPS','QUESTS','INVENTORY','PLAYER','QR','NOTE','PICKGAME','JAVASCRIPT') NOT NULL DEFAULT 'NONE';
ALTER TABLE quests ADD COLUMN complete_notif_go_function ENUM('NONE','NEARBY','GPS','QUESTS','INVENTORY','PLAYER','QR','NOTE','PICKGAME','JAVASCRIPT') NOT NULL DEFAULT 'NONE';
ALTER TABLE quests CHANGE complete_go_function complete_go_function ENUM('NONE','NEARBY','GPS','QUESTS','INVENTORY','PLAYER','QR','NOTE','PICKGAME','JAVASCRIPT') NOT NULL DEFAULT 'NONE';

ALTER TABLE notes ADD COLUMN description tinytext NOT NULL DEFAULT "";

DROP TABLE overlay_tiles;
DROP TABLE overlays;

CREATE TABLE overlays (overlay_id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT, game_id INT(11) UNSIGNED NOT NULL, name VARCHAR(100) NOT NULL DEFAULT "", media_id INT(11) UNSIGNED NOT NULL, top_left_latitude DOUBLE NOT NULL DEFAULT 0.0, top_left_longitude DOUBLE NOT NULL DEFAULT 0.0, top_right_latitude DOUBLE NOT NULL DEFAULT 0.0, top_right_longitude DOUBLE NOT NULL DEFAULT 0.0, bottom_left_latitude DOUBLE NOT NULL DEFAULT 0.0, bottom_left_longitude DOUBLE NOT NULL DEFAULT 0.0, PRIMARY KEY (overlay_id)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

CREATE INDEX game_id ON overlays (game_id);

