<html>
<head>
<script type="text/javascript">
    function parseURLParams(url) 
    {
        var queryStart = url.indexOf("?") + 1;
        var queryEnd   = url.indexOf("#") + 1 || url.length + 1;
        var query      = url.slice(queryStart, queryEnd - 1);

        var params  = {};
        if (query === url || query === "") return params;
        var nvPairs = query.replace(/\+/g, " ").split("&");

        for(var i=0; i<nvPairs.length; i++)
        {
            var nv = nvPairs[i].split("=");
            var n  = decodeURIComponent(nv[0]);
            var v  = decodeURIComponent(nv[1]);
            if(!(n in params)) params[n] = [];
            params[n].push(nv.length === 2 ? v : null);
        }
        return params;
    }

    function sendRequest(fn, params, method)
    {
        var xmlhttp;
        xmlhttp=new XMLHttpRequest();
        xmlhttp.open(method,"http://dev.arisgames.org/server/json.php/v1."+fn,false);
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(params); //Synchronous call

        return JSON.parse(xmlhttp.responseText);
    }

    var currentRequirementId;
    function load()
    {
        var request = 
'\
{\n\
  "game_id":123,\n\
  "name":"requirementPackageName",\n\
  "and_packages": [\n\
    {\n\
      "name":"andPackageName",\n\
      "atoms": [\n\
        {\n\
          "bool_operator":0,\n\
          "requirement":"PLAYER_HAS_ITEM",\n\
          "content_id":1,\n\
          "qty":4,\n\
          "latitude":86.75309,\n\
          "longitude":3.141592\n\
        },\n\
        {\n\
          "bool_operator":1,\n\
          "requirement":"PLAYER_HAS_ITEM",\n\
          "content_id":2,\n\
          "qty":3,\n\
          "latitude":86.75309,\n\
          "longitude":3.141592\n\
        }\n\
      ]\n\
    },\n\
    {\n\
      "name":"andPackageName2",\n\
      "atoms": [\n\
        {\n\
          "bool_operator":0,\n\
          "requirement":"PLAYER_HAS_ITEM",\n\
          "content_id":1,\n\
          "qty":4,\n\
          "latitude":86.75309,\n\
          "longitude":3.141592\n\
        },\n\
        {\n\
          "bool_operator":1,\n\
          "requirement":"PLAYER_HAS_ITEM",\n\
          "content_id":2,\n\
          "qty":3,\n\
          "latitude":86.75309,\n\
          "longitude":3.141592\n\
        }\n\
      ]\n\
    }\n\
  ]\n\
}\n\
'
            document.getElementById('create_request').value = request;
    }

    function submitCreate()
    {
        var response = sendRequest("requirements.createRequirementPackage", document.getElementById('create_request').value, "POST");
        document.getElementById('result').innerHTML = JSON.stringify(response);
        currentRequirementId = response.requirement_root_package_id;
        submitGet();
    }

    function submitUpdate()
    {
        var response = sendRequest("requirements.updateRequirementPackage", document.getElementById('update_request').value, "POST");
        document.getElementById('result').innerHTML = JSON.stringify(response);
        currentRequirementId = response.requirement_root_package_id;
        submitGet();
    }

    function submitDelete()
    {
        var response = sendRequest("requirements.deleteRequirementPackage/"+currentRequirementId, null, "GET");
        document.getElementById('result').innerHTML = JSON.stringify(response);
        submitGet();
    }

    function submitGet()
    {
        var response = sendRequest("requirements.getRequirementPackage/"+currentRequirementId, null, "GET");
        document.getElementById('current_requirement_get_result').innerHTML = JSON.stringify(response);
        currentRequirementId = response.requirement_root_package_id;
    }

</script>
</head>
<body onload="load()">

<div id="request_inputs" style="min-height:400px; width:66%; float:left;">
    <div style="min-height:200px;">
    Create: <button id='create_request_submit' onclick='submitCreate()'>create</button><br />
    <textarea id='create_request' style="width:100%; min-height:180px;"></textarea><br />
    </div>

    <div style="min-height:200px;">
    Update: <button id='update_request_submit' onclick='submitUpdate()'>update</button><br />
    <textarea id='update_request' style="width:100%; min-height:180px;"></textarea><br />
    </div>
</div>

<div id="current_requirement" style="min-height:400px; width:33%; float:right;">
    Current Requirement: <button id='delete_request_submit' onclick='submitDelete()'>delete</button> <br />
    <div id='current_requirement_get_result' style="width:100%;"> 
    (No requirement requested)
    </div>
</div>

Result:<br />
<div id='result'> 
(No Requests made)
</div>
</body>
</html>

