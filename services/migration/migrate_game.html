<html>
<head>
<script type="text/javascript">

    function parseURLParams(url) 
    {
        var queryStart = url.indexOf("?") + 1;
        var queryEnd   = url.indexOf("#") + 1 || url.length + 1;
        var query      = url.slice(queryStart, queryEnd - 1);

        var params  = {};
        if (query === url || query === "") return params;
        var nvPairs = query.replace(/\+/g, " ").split("&");

        for(var i=0; i<nvPairs.length; i++)
        {
            var nv = nvPairs[i].split("=");
            var n  = decodeURIComponent(nv[0]);
            var v  = decodeURIComponent(nv[1]);
            if(!(n in params)) params[n] = [];
            params[n].push(nv.length === 2 ? v : null);
        }
        return params;
    }

    function sendRequest(serv, fn, params, method)
    {
        var xmlhttp;
        xmlhttp=new XMLHttpRequest();
        xmlhttp.open(method,"http://"+serv+"arisgames.org/server/json.php/"+fn,false);
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(params); //Synchronous call

        return JSON.parse(xmlhttp.responseText);
    }

    
    var editor_id = 0;
    var rw_token = "";
    var v1_games = [];
    function submitAuth()
    {
        var response = sendRequest('','v1.editors.getToken/'+document.getElementById('editor_name').value+"/"+document.getElementById('editor_pass').value+"/read_write", null, "GET");
        if(!response.data) return "NO";
        editor_id = response.data.editor_id;
        rw_token = response.data.read_write_token;
        var response = sendRequest('','v1.games.getGamesForEditor/'+editor_id+"/"+rw_token, null, "GET");
        if(!response.data) return "NO";
        v1_games = response.data;

        gamesDiv = document.getElementById('games');
        var gameDiv;
        for(var i = 0; i < v1_games.length; i++)
        {
            gameDiv = document.createElement('li');
			gameDiv.className = "list-group-item clearfix";
            gameDiv.innerHTML = v1_games[i].name+" <button class='btn btn-info btn-sm pull-right' onclick='migrateGame("+i+")'>Migrate</button>";
            gamesDiv.appendChild(gameDiv);
        }
    }

    function migrateGame(i)
    {
        if(!v1_games[i]) return;
        var game = v1_games[i];

        var response = sendRequest('dev.','migration.migration.migrateGame/'+game.game_id+"/"+editor_id+"/"+rw_token, null, "GET");
        if(!response.data) return "NO";
    }

</script>

		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>ARIS Game Migration</title>
		<link rel="stylesheet" href="styles/bootstrap.css">
		<link rel="stylesheet" href="styles/arisjs.css">
</head>
<body id="body">

	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="navbar-header">
			<a class="aris-logo" href="#">
				<img src="images/Aris-Horizontal251.png">
			</a>
		</div>
	</nav>

	<div class="container-fluid full-height">
		<div class="row full-height">

			<div class="well well-lg shrink-center">
				<h4>Login using V1 Editor Account</h4>

				<div class="form-group">
					<input id="editor_name" type="text" placeholder="Username" class="form-control"></input>
				</div>
				<div class="form-group">
					<input id="editor_pass" type="password" placeholder="Password" class="form-control"></input>
				</div>
				<button type="button" onclick='submitAuth()' class="btn btn-block btn-primary">Login</button>
			</div>

			<div class="games-list shrink-center well well-lg">
				<h4>Your Games</h4>

				<ul id="games" class="list-group games">
				</ul>
			</div>
		</div>
	</div>

	<!--
<div id="login">
    <table id="user_inputs">
    <tr> <td> Sign In v1 Editor:</td><td><button onclick='submitAuth()'>Authenticate</button></td> </tr>
    <tr> <td style='text-align:right;'>Username:</td> <td><input id='editor_name' type='text'>    </input></td> </tr>
    <tr> <td style='text-align:right;'>Password:</td> <td><input id='editor_pass' type='password'></input></td> </tr>
    <tr> <td>  </td> </tr>
    </table>
</div> -->

</body>
</html>

