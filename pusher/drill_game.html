<!DOCTYPE html>
<html>
<head>
<title>Drill Game</title>
<script src="http://js.pusher.com/1.11/pusher.min.js" type="text/javascript"></script>
<script type="text/javascript">

//RECEIVE
var pusher = new Pusher('7fe26fe9f55d4b78ea02');
var drillOn = false;
var min = 150;
var temp = min;
var greenYellow = 200;
var yellowRed = 260;
var max =300;
var yellowMax = yellowRed-greenYellow;
var redMax = max-yellowRed;
var depth = 0;
var notReset = false;

var arduino_channel = pusher.subscribe('arduino-pusher_room_channel');
arduino_channel.bind('arduino_event_register', function(data) {
                     document.getElementById('arduino_messages').innerHTML = document.getElementById('arduino_messages').innerHTML + "<br />\nMessage Received (arduino_event_register): "+data;
                     });
arduino_channel.bind('Drill_On', function(data) {
                     drillOn = true;
                     });
arduino_channel.bind('Drill_Off', function(data) {
                     drillOn = false;
                     });

function tick(){
    if(drillOn && !notReset){
        if(temp<=max){
            temp+=2;
        }
        else{
            document.getElementById("drilledRock").style.display = "none";
            document.getElementById("tempGraph").style.display = "none";
            document.getElementById("brokenDrill").style.display = "block";
            notReset = true;
        }
        depth+=1.5;
    }
    else{
        if(temp <=greenYellow){
            temp-=1;
        }
        else if(temp <=yellowRed){
            temp-=0.75;
        }
        else{
            temp -=0.25;
        }
        if(temp < min){
            temp = min;
        }
    }
    if(temp <= greenYellow){
        document.getElementById("greenBar").width = temp;
        document.getElementById("yellowBar").width = 0;
        document.getElementById("redBar").width = 0; 
    }
    else if(temp <= yellowRed){
        document.getElementById("greenBar").width = greenYellow; 
        document.getElementById("yellowBar").width = (temp-greenYellow); 
        document.getElementById("redBar").width = 0;     
    }
    else if(temp <= max){
        document.getElementById("greenBar").width = greenYellow; 
        document.getElementById("yellowBar").width = yellowMax;
        document.getElementById("redBar").width = (temp-yellowRed);    
    }
    else{
        document.getElementById("greenBar").width = greenYellow; 
        document.getElementById("yellowBar").width = yellowMax;
        document.getElementById("redBar").width = redMax;          
    }
    if(depth <= 300){
        document.getElementById("blackBar").width = depth;   
    }
    else if(!notReset){
        document.getElementById("drilledRock").style.display = "none";
        document.getElementById("tempGraph").style.display = "none";
        document.getElementById("drilledHole").style.display = "block";
        notReset = true;
    }
    var t=setTimeout("tick()", 50);
}
    
function reset(){
    depth = 0;
    temp = 150;
    notReset = false;
    document.getElementById("drilledRock").style.display = "block";
    document.getElementById("tempGraph").style.display = "block";
    document.getElementById("drilledHole").style.display = "none";  
    document.getElementById("brokenDrill").style.display = "none";
}
    
</script>
</head>
<body onload="tick()">

<div id= "drilledRock" style="background-image:url(../pusher/images/rock.jpg); height:200px; width:300px; display:block;">
<img style="position:absolute; top:100px;" src="images/black.jpg" id="blackBar" alt="Drill depth." width="0" height="30" />
</div>

<div id = "tempGraph" style = "display:block;">
<br/>
<br/>
<table cellpadding = 0 cellspacing = 0>
<tr>
<td><img src="images/green.jpg" id="greenBar" alt="Low temperature." width="0" height="40" /></td>
<td><img src="images/yellow.jpg" id="yellowBar" alt="Heating up." width="0" height="40" /></td>
<td><img src="images/red.jpg" id="redBar" alt="Too hot." width="0" height="40" /></td>
</tr>
</table>
</div>

<div id="brokenDrill" style="display:none;">
<img src="images/brokenDrill.jpg" id="brokenDrillPic" alt="Broken drill bit." onClick="reset()" width="300" height="400" />
</div>

<div id="drilledHole" style="display:none;">
<img src="images/hole.jpg" id="emptyHole" alt="Drilled out hole to put dynamite in." onClick="reset()" width="300" height="400" />
</div>

<br/>
<br/>

<div id="arduino_messages">
Waiting...
</div>

</body>
</html>
