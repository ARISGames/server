<html>
<head>
<title>Blaster Game</title>
<meta name="viewport" content="width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
<script src="json2.js"></script>
<script src="http://js.pusher.com/1.11/pusher.min.js" type="text/javascript"></script>
    
    
<script type="text/javascript">

//Define States
const kStateIntro = "INTRO";
const kStateLoading = "LOADING";
const kStateLoaded = "LOADED";
const kStateUnloading = "UNLOADING";
const kStateSuccess = "SUCCESS";
const kStateFailure = "FAILURE";

//Pusher Variables
const app_key = '7fe26fe9f55d4b78ea02';
const channel_name = 'dynamite';

//Define Pusher Events
const kEventUpdate = "update";
const kEventUpdateRequested = "update_requested";
const kEventPlunger = "plunger";
const kEventAccident = "accident";

//Define Pusher Update Event States
const kEventUpdateStateLoading = "LOADING";
const kEventUpdateStateLoading = "UNLOADING";

//Init state
var state = kStateIntro;

//Setup Pusher Bindings
var pusher = new Pusher(app_key);
var pusher_channel = pusher.subscribe(channel_name);

pusher_channel.bind(kEventUpdate, 
function(data) {
	console.log('Update Recieved with data: ' + data);
	var dataObject = JSON.parse(data);
	console.log('State: '+ dataObject.state + ' Slots:' + dataObject.slots);
	updateSlotImages(dataObject.slots);

	//Check for all slots full                
	//if ((state == kStateLoading) && (dataObject.slots[0] && dataObject.slots[1] && dataObject.slots[2] && dataObject.slots[3] && dataObject.slots[4] && dataObject.slots[5]))
		//updateState(kStateLoaded);

	//Check for any empty slots
	//if ((state == kStateUnloading || state == kStateSuccess || state == kStateFailure) && (!dataObject.slots[0] || !dataObject.slots[1] || !dataObject.slots[2] || !dataObject.slots[3] || !dataObject.slots[4] || !dataObject.slots[5]))
		//updateState(kStateLoading)
});

pusher_channel.bind(kEventPlunger, 
function(data) {
	//console.log('Plunger Recieved with data: ' + data);
	//updateState(kStateSuccess);
});

pusher_channel.bind(kEventAccident, 
function(data) {
	//console.log('Accident Recieved with data: ' + data);
	//updateState(kStateFailure);
});

function updateSlotImages(slotsArray){
	if (slotsArray[0]) document.getElementById("slot1").src = "images/slot1_filled.jpg";
	else document.getElementById("slot1").src = "images/slot1.jpg";

	if (slotsArray[1]) document.getElementById("slot2").src = "images/slot2_filled.jpg";
	else document.getElementById("slot2").src = "images/slot2.jpg";

	if (slotsArray[2]) document.getElementById("slot3").src = "images/slot3_filled.jpg";
	else document.getElementById("slot3").src = "images/slot3.jpg";

	if (slotsArray[3]) document.getElementById("slot4").src = "images/slot4_filled.jpg";
	else document.getElementById("slot4").src = "images/slot4.jpg";

	if (slotsArray[4]) document.getElementById("slot5").src = "images/slot5_filled.jpg";
	else document.getElementById("slot5").src = "images/slot5.jpg";

	if (slotsArray[5]) document.getElementById("slot6").src = "images/slot6_filled.jpg";
	else document.getElementById("slot6").src = "images/slot6.jpg";
}

function updateState(newState)
{
	console.log("Updating to state: " + newState);

	//Start Clean
	document.getElementById("intro").style.display = "none"; 
	//document.getElementById("wall").style.display = "none"; 
	document.getElementById("unload").style.display = "none"; 
	document.getElementById("success").style.display = "none"; 
	document.getElementById("failure").style.display = "none"; 

	switch (newState){
		case kStateIntro:
			//document.getElementById("intro").style.display = "block"; 
			break;
		case kStateLoading:
			document.getElementById("wall").style.display = "block"; 
			document.getElementById("message").src = "images/message_load.jpg";
			break;
		case kStateLoaded:
			//document.getElementById("wall").style.display = "block"; 
			//document.getElementById("message").src = "images/message_plunge.jpg";
			break;
		case kStateUnloading:
			//document.getElementById("unload").style.display = "block"; 
			break;
		case kStateSuccess:
			//document.getElementById("success").style.display = "block"; 
			break;
		case kStateFailure:
			//document.getElementById("failure").style.display = "block"; 
			break;
	}
	state = newState;
}


</script>
</head>
<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onload="updateState(kStateLoading)">

<div id="intro" style="display:none;">
<img src="images/intro.jpg" id="opening" alt="Miners planting explosives." width="320" height="416" /><!--//onClick="updateState(kStateLoading)" -->
</div>    

<div id="wall" style = "display:none;">
<!-- Save for Web Slices (rockWall.psd) -->
<table id="Table_01" width="321" height="417" border="0" cellpadding="0" cellspacing="0">
<tr>
<td colspan="13">
<img src="images/rockWall_01.jpg" width="320" height="12" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="12" alt=""></td>
</tr>
<tr>
<td colspan="8" rowspan="2">
<img src="images/rockWall_02.jpg" width="155" height="54" alt=""></td>
<td colspan="3">
<img id = "slot1" src="images/slot1.jpg" width="36" height="35" alt=""></td>
<td colspan="2" rowspan="8">
<img src="images/rockWall_04.jpg" width="129" height="202" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="35" alt=""></td>
</tr>
<tr>
<td colspan="3" rowspan="3">
<img src="images/rockWall_05.jpg" width="36" height="71" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="19" alt=""></td>
</tr>
<tr>
<td rowspan="10">
<img src="images/rockWall_06.jpg" width="20" height="254" alt=""></td>
<td>
<img id = "slot2" src="images/slot2.jpg" width="34" height="34" alt=""></td>
<td colspan="6" rowspan="2">
<img src="images/rockWall_08.jpg" width="101" height="52" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="34" alt=""></td>
</tr>
<tr>
<td rowspan="9">
<img src="images/rockWall_09.jpg" width="34" height="220" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="18" alt=""></td>
</tr>
<tr>
<td colspan="5" rowspan="2">
<img src="images/rockWall_10.jpg" width="72" height="50" alt=""></td>
<td colspan="2">
<img id = "slot3" src="images/slot3.jpg" width="35" height="34" alt=""></td>
<td colspan="2" rowspan="4">
<img src="images/rockWall_12.jpg" width="30" height="96" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="34" alt=""></td>
</tr>
<tr>
<td colspan="2" rowspan="7">
<img src="images/rockWall_13.jpg" width="35" height="168" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="16" alt=""></td>
</tr>
<tr>
<td rowspan="6">
<img src="images/rockWall_14.jpg" width="4" height="152" alt=""></td>
<td colspan="2">
<img id = "slot4" src="images/slot4.jpg" width="34" height="34" alt=""></td>
<td colspan="2" rowspan="3">
<img src="images/rockWall_16.jpg" width="34" height="69" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="34" alt=""></td>
</tr>
<tr>
<td colspan="2" rowspan="2">
<img src="images/rockWall_17.jpg" width="34" height="35" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="12" alt=""></td>
</tr>
<tr>
<td rowspan="4">
<img src="images/rockWall_18.jpg" width="6" height="106" alt=""></td>
<td colspan="2" rowspan="2">
<img id = "slot5" src="images/slot5.jpg" width="34" height="35" alt=""></td>
<td rowspan="4">
<img src="images/rockWall_20.jpg" width="119" height="106" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="23" alt=""></td>
</tr>
<tr>
<td rowspan="3">
<img src="images/rockWall_21.jpg" width="19" height="83" alt=""></td>
<td colspan="2" rowspan="2">
<img id = "slot6" src="images/slot6.jpg" width="35" height="34" alt=""></td>
<td rowspan="3">
<img src="images/rockWall_23.jpg" width="14" height="83" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="12" alt=""></td>
</tr>
<tr>
<td colspan="2" rowspan="2">
<img src="images/rockWall_24.jpg" width="34" height="71" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="22" alt=""></td>
</tr>
<tr>
<td colspan="2">
<img src="images/rockWall_25.jpg" width="35" height="49" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="49" alt=""></td>
</tr>
<tr>
<td colspan="13">
<img id = "message" src="images/message_load.jpg" width="320" height="66" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="66" alt=""></td>
</tr>
<tr>
<td colspan="13">
<img src="images/rockWall_27.jpg" width="320" height="30" alt=""></td>
<td>
<img src="images/spacer.gif" width="1" height="30" alt=""></td>
</tr>
<tr>
<td>
<img src="images/spacer.gif" width="20" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="34" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="4" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="19" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="15" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="20" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="14" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="29" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="6" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="6" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="24" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="10" height="1" alt=""></td>
<td>
<img src="images/spacer.gif" width="119" height="1" alt=""></td>
<td></td>
</tr>
</table>
<!-- End Save for Web Slices -->
</div>

<div id="success" style="display:none;">
<img src="images/success.jpg" width="320" height="416" /><!-- onClick="updateState(kStateUnloading)" -->
</div>

<div id="failure" style="display:none;">
<img src="images/failure.jpg" width="320" height="416" /><!-- onClick="updateState(kStateUnloading)" -->
</div>

<div id="unload" style="display:none;">
<img src="images/unloading.jpg" width="320" height="416" />
</div>

</body>


</html>
