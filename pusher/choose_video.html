<!DOCTYPE html>
<html>
    <head>
        <title>Choose Video</title>
        <script src="http://js.pusher.com/1.11/pusher.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            
            var pusher = new Pusher('7fe26fe9f55d4b78ea02');
            Pusher.channel_auth_endpoint = 'presence_auth.php';
            var voted = false;
            var votesfor1 = 0;
            var votesfor2 = 0;
            var pusher_channel = 'arduino-choose_video';
            var pusher_event_register = 'arduino_event_register';

            //Arduino
            var arduino_channel = pusher.subscribe(pusher_channel);
            var presence_channel = pusher.subscribe('presence-pusher_room_channel');
            arduino_channel.bind('arduino_event_register', function(data) {
                                 document.getElementById('arduino_messages').innerHTML = document.getElementById('arduino_messages').innerHTML + "<br />\nMessage Received(arduino_event_register): "+data;
                                 });
            arduino_channel.bind('Start', function(data) {
                                 document.getElementById("introduction").style.display = "none";
                                 document.getElementById("votingOptions").style.display = "block";
                                 });
            arduino_channel.bind('Done_Voting', function(data) {
                                 document.getElementById('arduino_messages').innerHTML = "Please enjoy video ";
                                 if(votesfor1 >= votesfor2){
                                 document.getElementById('arduino_messages').innerHTML += "1";
                                 }
                                 else{
                                 document.getElementById('arduino_messages').innerHTML += "2";
                                 }
                                 var t=setTimeout("reset()",5000);
                                 });
            arduino_channel.bind('Vote', function(data) {
                                 votesfor1 = data.charAt(0);
                                 votesfor2 = data.charAt(1);
                                 document.getElementById('arduino_messages').innerHTML = "Votes for Video 1: " + votesfor1 + " Votes for Video 2: " + votesfor2;
                                 });
            arduino_channel.bind('Clock_Time', function(data) {
                                 var time = 15-data;
                                 document.getElementById('arduino_messages').innerHTML = time;
                                 });
            presence_channel.bind('pusher:member_added', function(members) {
                                  sendRequest('a', "arduino");// You have something listening on a presence channel and sending data on an arduino channel. It's confusing the room.php code. -Phil
                                  });
            presence_channel.bind('pusher:member_removed', function(members) {
                                  sendRequest('s', "arduino");
                                  });
            
            
            //SEND
            function sendRequest(data, room)
        	{
                var xmlhttp;
                xmlhttp=new XMLHttpRequest();
                xmlhttp.open("POST","http://dev.arisgames.org/server/pusher/"+room+"_send.php?arduino_channel=MYROOM",false);
                xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xmlhttp.send(room+'_data='+data); //Synchronous call
                
              //  document.getElementById(room+'_messages').innerHTML = document.getElementById(room+'_messages').innerHTML + "<br />\nMessage Sent ("+room+"): "+xmlhttp.responseText;
        	}
            
        	function message(room)
        	{
                sendRequest(document.getElementById(room+'_sendtext').value, room);
            }
            function vote(voteNumber)
            {
                if(!voted){
                    document.getElementById("video1").src = "images/grayOne.jpg"; 
                    document.getElementById("video2").src = "images/grayTwo.jpg"; 
                    sendRequest(voteNumber, "arduino"); 
                }
                voted = true;
            }
            function reset()
            {
                    document.getElementById("video1").src = "images/one.jpg"; 
                    document.getElementById("video2").src = "images/two.jpg"; 
                    document.getElementById("introduction").style.display = "block";
                    document.getElementById("votingOptions").style.display = "none";
                    //sendRequest(voteNumber, "arduino"); 
                    voted = false;
            }
            </script>
    </head>
    <body>
        
        <div id="introduction" style = "display:block;">
              <img src="images/black.jpg" id="intro" alt="Introduction" width="200" height="300" />
        </div>
        
        <div id="votingOptions" style = "display:none;">
        <br/>
        <br/>
        <br/>
        <table cellpadding = 0 cellspacing = 100>
            <tr>
                <td>
                    <div>
                    <img src="images/one.jpg" id="video1" alt="One" onClick="vote('v1');" width="50" height="100" />
                    </div>
                </td>
                <td>
                    <div>
                        <img src="images/two.jpg" id="video2" alt="Two" onClick="vote('v2');" width="50" height="100" />
                    </div>
                </td>
            </tr>
        </table>
        <br/>
        <br/>
        <br/>
        <br/>
        </div>
            
        <div id="arduino_messages">
        </div>
        
        
        
    </body>
</html>
